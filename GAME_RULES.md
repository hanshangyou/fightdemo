# 游戏规则说明

版本：v1.3.1-2026-02-19

## 战斗规则
- 阵营：我方为 A 队，敌方为 B 队。
- 地图：六边形格子地图；仅能在地图格子上行动。
- 布阵：准备阶段将我方角色放置在“我方格子”，放满关卡上限后可开始战斗。
- 行动点（AP）：每回合开始时恢复至 7 点。
- 行动方式：
  - 移动：可移动到相邻六方向的空格；相邻存在敌方单位时，移动消耗翻倍。
  - 攻击：消耗当前武器的 apCost；攻击范围由武器 range 决定。
    - range=1：相邻六方向 6 格。
    - range=2：相邻六方向 6 格 + 同方向直线延伸 1 格（共 12 格）。
    - range=3：距离为 2 的环形范围 + 同方向直线延伸 3 格的 6 格。
- 回合顺序：每回合按速度从高到低排序存活单位依次行动。
- 回合上限：超过回合上限仍未分出胜负则判定我方失败。
- 伤害结算：
  - 武器伤害 = 武器区间随机值 × (1 + 攻击方 STR - 10) × 5 / 100。
  - 命中率 = clamp(0.9 -(distance-1)/10 + 0.3*distance*(攻方DEX-守方DEX)/100*5, 0.3, 0.99)。
    - 命中成功：按 100% 武器伤害结算。
    - 命中失败：造成 0 伤害。
  - 格挡率 = clamp(0.3 -(distance-1)/10 - 0.9/distance*(攻方STR-守方STR)/100*7, 0.01, 0.99)。
    - 格挡成功：造成 20% 武器伤害。
    - 格挡失败：造成 100% 武器伤害。
  - 结算顺序：先判定命中，再判定格挡。
- 胜负判定：任意一方无存活角色即判负。
- 统计数据：我方记录总伤害、攻击次数、击杀数与总回合数。

## 抽卡规则
- 卡池范围：只包含非 ENEMY 稀有度角色。
- 抽卡类型：
  - 开局抽卡：10 连（消耗 1 张抽卡券），整局仅可抽 1 次。
  - 营地抽卡：5 连（消耗 1 张抽卡券），每个营地仅可抽 1 次，选 1 张加入备选池。
- 稀有度概率：
  - 普通 60%
  - 稀有 25%
  - 史诗 12%
  - 传说 3%
- 数值计算：
  - 角色属性 = round(基础属性 × 稀有度倍率)
  - 稀有度倍率：普通 1.0，稀有 1.2，史诗 1.5，传说 2.0

## 组队与关卡规则
- 队伍人数：最少 1 人，最多为关卡配置的 maxTeamSize。
- 关卡人数上限：由关卡编辑器配置并存储在关卡数据中。
- 默认关卡上限：第 1-2 关为 3 人，第 3-4 关为 4 人，第 5-6 关为 5 人。
- 关卡地图：每个关卡可保存独立默认地图；未设置时使用全局默认地图。
- 地图重置：重置关卡地图时优先使用该关卡默认地图。
- 备选池规则：
  - 抽卡保留角色会进入备选池。
  - 每次挑战前从备选池组队。
  - 战斗中阵亡角色会在备选池中标记为“已死亡”，无法上场。
  - 战斗失败后，本场阵亡的角色会恢复为可用状态。
- 流程说明：
  - 胜利后进入结算，再进入营地。
  - 失败后返回营地重选队伍，不会推进关卡。
