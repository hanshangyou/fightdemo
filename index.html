<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>回合制战斗游戏</title>
    <link rel="stylesheet" href="src/styles/index.css">
</head>
<body>
    <div id="game-container">
        <div id="screen-main" class="screen active">
            <div class="header">
                <div class="game-title">⚔️ 英雄战斗 ⚔️</div>
            </div>
            <div class="resources">
                <div class="resource-item">💰 <span id="main-gold">0</span></div>
                <div class="resource-item">🎫 <span id="main-tickets">0</span></div>
            </div>
            <div class="stage-info">
                <div class="stage-number">关卡 <span id="main-stage">1</span>/3</div>
                <div class="stage-name" id="stage-name">第1关：新手村</div>
                <div class="stage-desc" id="stage-desc">击败弱小的哥布林团伙</div>
                <div class="stage-desc">可上场人数上限: <span id="stage-team-max">3</span></div>
            </div>
            <div class="team-status" id="main-team-info" style="text-align:center; padding:10px; background:rgba(0,0,0,0.2); border-radius:8px; margin-bottom:10px;">
                <span style="color:#e74c3c">未组建队伍</span>
            </div>
            <div class="menu-buttons">
                <button class="btn btn-warning" id="btn-gacha">🎰 抽卡组队</button>
                <button class="btn btn-success" id="btn-battle">⚔️ 开始战斗</button>
                <div class="editor-buttons-row">
                    <button class="btn btn-editor" id="btn-editor">📝 卡池编辑</button>
                    <button class="btn btn-editor" id="btn-weapon-editor">🛠️ 武器编辑</button>
                    <button class="btn btn-stage-editor" id="btn-stage-editor">🏰 关卡编辑</button>
                </div>
            </div>
        </div>
        
        <div id="screen-gacha" class="screen">
            <div class="screen-title">🎰 抽卡组队</div>
            <div class="resources">
                <div class="resource-item">🎫 抽卡券: <span id="gacha-tickets">0</span></div>
                <div class="team-count">已选: <span id="team-count">0</span> / 可上场: <span id="team-max">3</span></div>
            </div>
            
            <div class="draw-pool" id="draw-pool">
                <div class="empty-hint">点击下方按钮抽取10个角色</div>
            </div>
            
            <div class="gacha-buttons">
                <div class="button-row">
                    <button class="btn btn-warning" id="btn-pull">🎰 抽卡 (1券)</button>
                    <button class="btn btn-danger" id="btn-reroll">🔄 重抽 (1券)</button>
                </div>
                <div class="button-row">
                    <button class="btn btn-secondary" id="btn-back-gacha">返回</button>
                    <button class="btn btn-success" id="btn-confirm">⚔️ 开始战斗</button>
                </div>
            </div>
        </div>
        
        <div id="screen-battle" class="screen">
            <div class="battle-topbar">
                <div class="battle-stage-info">
                    <div class="prep-stage" id="battle-prep-stage-name"></div>
                    <div class="phase-label" id="battle-phase-label"></div>
                </div>
                <div class="battle-log" id="battle-log" hidden>
                    <div class="battle-log-list" id="battle-log-list"></div>
                </div>
            </div>
            <div class="battle-toast" id="battle-toast" hidden></div>
            <div class="turn-order" id="battle-turn-order">
                <div class="order-row">
                    <div class="order-list" id="battle-turn-order-list"></div>
                </div>
            </div>
            <div class="enemy-pool-panel">
                <div class="enemy-pool-grid" id="battle-enemy-pool"></div>
            </div>

            <div class="battlefield-container">
                <div class="editor-bar" id="battle-editor-bar" hidden>
                    <div class="editor-row tools">
                        <button class="editor-btn active" data-tool="select" type="button">选择/移动</button>
                        <button class="editor-btn" data-tool="add" type="button">添加</button>
                        <button class="editor-btn" data-tool="delete" type="button">删除</button>
                        <button class="editor-btn" data-tool="paint" type="button">改类型</button>
                        <button class="editor-btn" id="battle-editor-save-default" type="button">设为默认</button>
                        <button class="editor-btn" id="battle-editor-save-stage" type="button">保存关卡</button>
                        <button class="editor-btn" id="battle-editor-reset" type="button">重置</button>
                    </div>
                    <div class="editor-row types disabled" data-type-row>
                        <button class="editor-btn active" data-kind="neutral" type="button">中性</button>
                        <button class="editor-btn" data-kind="boundary" type="button">野外</button>
                        <button class="editor-btn" data-kind="ally" type="button">我方</button>
                        <button class="editor-btn" data-kind="enemy" type="button">敌方</button>
                    </div>
                </div>
                <div class="hex-map" id="battle-hex-map"></div>
                <div class="coord-display" id="battle-coord-display" hidden></div>
                <div class="legend">
                    <div class="legend-item"><span class="legend-swatch boundary"></span><span>野外</span></div>
                    <div class="legend-item"><span class="legend-swatch ally"></span><span>我方</span></div>
                    <div class="legend-item"><span class="legend-swatch enemy"></span><span>敌方</span></div>
                    <div class="legend-item"><span class="legend-swatch neutral"></span><span>中性</span></div>
                </div>
            </div>

            <div class="action-area">
                <div class="battle-action-layout" id="battle-action-layout">
                    <div class="battle-action-panel">
                        <div class="battle-active-unit" id="battle-active-unit"></div>
                    </div>
                    <div class="battle-action-panel">
                        <div class="battle-target-header">
                            <div class="battle-panel-title">攻击范围</div>
                            <button class="btn btn-secondary battle-skip-btn" id="battle-skip-turn-btn" type="button">跳过回合</button>
                        </div>
                        <div class="battle-target-list" id="battle-target-list"></div>
                    </div>
                </div>
                <div class="prep-panel">
                    <div class="pool-section">
                        <div class="pool-grid" id="battle-player-pool"></div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="battle-start-battle-btn">开始战斗<span class="battle-player-count" id="battle-player-count"></span></button>
                        <button class="btn btn-secondary" id="battle-reset-placement-btn">重置布阵</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="screen-camp" class="screen">
            <div class="camp-container">
                <div class="camp-header">
                    <div class="camp-title" id="camp-title">🏕️ 营地</div>
                    <div class="camp-subtitle" id="camp-subtitle">整备队伍，准备挑战下一关</div>
                </div>

                <div class="camp-panel">
                    <div class="camp-panel-title">当前营地角色（<span id="camp-available-count">0</span>）</div>
                    <div class="camp-team-grid" id="camp-team"></div>
                </div>

                <div class="camp-actions-grid">
                    <button class="btn btn-warning" id="btn-camp-recruit">🎯 招募</button>
                    <button class="btn btn-success" id="btn-camp-weapons">🧰 武器</button>
                    <button class="btn btn-secondary" id="btn-camp-armor" disabled>🛡️ 盔甲</button>
                </div>

                <div class="camp-actions-row">
                    <button class="btn btn-secondary" id="btn-camp-save" disabled>💾 保存</button>
                    <button class="btn btn-success" id="btn-camp-next">➡️ 下一关</button>
                </div>

                <div class="button-row">
                    <button class="btn btn-secondary" id="btn-camp-home">🏠 返回首页</button>
                </div>
            </div>
        </div>

        <div class="camp-modal" id="camp-recruit-modal">
            <div class="camp-modal-content">
                <div class="camp-modal-header">
                    <div>🎯 营地招募</div>
                    <button class="btn btn-secondary" id="btn-camp-recruit-close">关闭</button>
                </div>
                <div class="camp-modal-body">
                    <div id="camp-recruit-hint">消耗1张抽卡券抽5张，并选择1张加入备选池</div>
                    <button class="btn btn-warning" id="btn-camp-recruit-draw">🎰 招募抽卡</button>
                    <div class="camp-recruit-grid" id="camp-recruit-draw"></div>
                </div>
            </div>
        </div>

        <div class="camp-modal" id="camp-weapon-modal">
            <div class="camp-modal-content">
                <div class="camp-modal-header">
                    <div>🧰 营地武器池</div>
                    <button class="btn btn-secondary" id="btn-camp-weapon-close">关闭</button>
                </div>
                <div class="camp-modal-body">
                    <div class="camp-weapon-pool" id="camp-weapon-pool"></div>
                </div>
            </div>
        </div>

        <div class="camp-weapon-popover" id="camp-weapon-popover">
            <div class="camp-weapon-popover-title" id="camp-weapon-popover-title"></div>
            <div class="camp-weapon-popover-current" id="camp-weapon-popover-current"></div>
            <div class="camp-weapon-popover-list" id="camp-weapon-popover-list"></div>
            <button class="btn btn-secondary" id="camp-weapon-popover-unequip">卸下武器</button>
        </div>
        
        <div id="screen-result" class="screen">
            <div class="result-container">
                <div class="result-title" id="result-title">🎉 胜利！</div>
                <div class="result-message" id="result-message">成功通过关卡！</div>
                <div class="result-rewards" id="result-rewards"></div>
                <div class="result-buttons">
                    <button class="btn btn-success" id="btn-next">下一关</button>
                    <button class="btn btn-primary" id="btn-retry">🔄 原队重试</button>
                    <button class="btn btn-danger" id="btn-restart">🔄 重新开始</button>
                    <button class="btn btn-secondary" id="btn-home">返回主页</button>
                </div>
            </div>
        </div>
        
        <div id="screen-editor" class="screen">
            <div class="editor-container" id="editor-container"></div>
        </div>
        
        <div id="screen-stage-editor" class="screen">
            <div class="editor-container" id="stage-editor-container"></div>
        </div>

        <div id="screen-map-editor" class="screen">
            <div class="status-header">
                <div class="status-info">
                    <button class="back-btn" id="map-editor-back" type="button">返回关卡</button>
                    <div class="stage-title" id="map-editor-stage-name">关卡地图</div>
                    <div class="stage-enemies" id="map-editor-stage-enemies"></div>
                    <button class="editor-toggle" id="map-editor-toggle" type="button">退出编辑</button>
                </div>
            </div>
            <div class="battlefield-container">
                <div class="editor-bar" id="map-editor-bar">
                    <div class="editor-row tools">
                        <button class="editor-btn active" data-tool="select" type="button">选择/移动</button>
                        <button class="editor-btn" data-tool="add" type="button">添加</button>
                        <button class="editor-btn" data-tool="delete" type="button">删除</button>
                        <button class="editor-btn" data-tool="paint" type="button">改类型</button>
                    </div>
                    <div class="editor-row types disabled" data-type-row>
                        <button class="editor-btn active" data-kind="neutral" type="button">中性</button>
                        <button class="editor-btn" data-kind="boundary" type="button">野外</button>
                        <button class="editor-btn" data-kind="ally" type="button">我方</button>
                        <button class="editor-btn" data-kind="enemy" type="button">敌方</button>
                    </div>
                </div>
                <div class="hex-map" id="map-editor-hex-map"></div>
                <div class="coord-display" id="map-editor-coord-display" hidden></div>
                <div class="legend">
                    <div class="legend-item"><span class="legend-swatch boundary"></span><span>野外</span></div>
                    <div class="legend-item"><span class="legend-swatch ally"></span><span>我方</span></div>
                    <div class="legend-item"><span class="legend-swatch enemy"></span><span>敌方</span></div>
                    <div class="legend-item"><span class="legend-swatch neutral"></span><span>中性</span></div>
                </div>
            </div>
            <div class="editor-footer">
                <button class="footer-btn primary" id="map-editor-save-stage" type="button">保存关卡</button>
                <button class="footer-btn" id="map-editor-save-default" type="button">设为默认</button>
                <button class="footer-btn" id="map-editor-reset" type="button">重置</button>
            </div>
            <div class="map-editor-toast" id="map-editor-toast">保存成功</div>
        </div>
    </div>
    <script type="module" src="src/main.js"></script>
</body>
</html>
